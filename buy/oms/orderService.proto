syntax = "proto3";
package services;
option go_package = "/.;services";
import "common/base.proto";
import "orderDetailService.proto";
import "orderAddressService.proto";
import "deliveryOrderService.proto";
import "baseInfoService.proto";

//订单管理(后台适用)
service OrderService {

    //用户支付订单【user】
    rpc Pay (OrderPayRequest) returns (OrderResponse) {}

    //用户取消订单
    rpc Cancel (OrderRequest) returns (OrderResponse) {}

    //订单删除
    rpc Delete (OrderRequest) returns (OrderResponse) {}

    //商家订单确认
    rpc Confirm (OrderRequest) returns (OrderResponse) {}

    //用户订单收货
    rpc Take (Order) returns (OrderResponse) {}

    // 商家核销订单
    rpc Verify (OrderRequest) returns (OrderResponse) {}

    //商家线下支付确认【admin】
    rpc OfflinePaid (OfflinePaidRequest) returns (OrderResponse) {}

    //订单插入【service】
    rpc OrderInsert (Order) returns (OrderResponse) {}

    //商家订单改价
    rpc ModifyPrice (Order) returns (OrderResponse) {}

    //修改订单地址
    rpc ModifyAddress (OrderAddress) returns (OrderResponse) {}

    //订单主信息列表(服务专用)
    rpc OrderMainInfo (OrderRequest) returns (OrderResponse) {}

    //订单主信息(服务专用)
    rpc OrderMainList (OrderRequest) returns (OrderResponse) {}

    //订单查询
    rpc Search (OrderRequest) returns (OrderResponse) {}

    //订单详情
    rpc Detail (Order) returns (OrderResponse) {}

    //拉取支付信息
    rpc PullPay (OrderRequest) returns (OrderResponse) {}

    //订单获取【service】
    rpc Get (Order) returns (OrderResponse) {}

    //订单列表【service】
    rpc List (OrderRequest) returns (OrderResponse) {}

    //新订单通知数据(循环模式：将弃用)
    rpc NewOrderNotice (OrderRequest) returns (OrderResponse) {}

}

message Order {
    int64 id = 1; //ID
    string order_no = 2; //订单号
    string type = 3; //订单类型
    string virtual_type =4;//虚拟类型
    int64 member_id = 5; //买家ID
    int64 shop_id = 6; //多商户ID
    int64 realstore_id = 7; //多门店ID
    int64 clerk_id = 8; //店员ID
    float total_count = 9; //购买总数
    int64 total_count_num = 10; //购买总件数
    int64 total_count_wgt = 11; //购买总称重
    int64 total_price = 12; //订单总价
    int64 total_postage = 13; //总邮费
    int64 increase_amount = 14; //增加金额
    int64 discount_amount = 15; //优惠总额
    int64 freight_price = 16; //运费金额
    int64 pay_postage = 17; //支付邮费
    int64 pay_price = 18; //实付金额
    string currency = 19; //货币类型
    int64 deduction_price = 20; //抵扣金额
    int64 coupon_id = 21; //使用优惠劵ID
    int64 coupon_price = 22; //使用优惠劵金额
    string is_modify_price = 23; //已修改价格
    int64 modify_price = 24; //修改优惠金额
    int64 cost = 25; //成本价
    int64 paid_amount = 26; //已支付金额
    int64 refunded_amount = 27; //已退款金额
    int32 shipping_type = 29; //配送方式
    string verify_code = 30; //核销码
    string is_multi_package = 31; //多包裹发货
    string ship_status = 32; //发货状态
    string subject = 33; //订单标题
    string cover_url = 34; //订单商品封面
    string user_note = 35; //订单附言
    string seller_note = 36; //商家留言
    string table_code = 37; //桌台编号
    string is_cod = 38; //是否货到付款
    string is_invoiced = 39; //已开过发票
    string is_refunded = 40; //已产生退款
    string is_modify_address = 41; //已修改地址
    repeated int64 cart_ids = 42; //购物车ids
    int32 payment_id = 43; //支付ID
    string pay_type = 44; //支付类型
    string pay_channel = 45; //支付通道
    string from_type = 46; //来源类型
    string routine_type = 47; //来源小程序类型
    string out_system_id = 48; //外部系统ID
    string pay_status = 49; //支付状态
    int64 gain_integral = 50; //消费赚取积分
    int64 use_integral = 51; //使用积分
    int64 back_integral = 52; //退回积分
    string is_stock_up = 53; //是否备货中
    string refund_status = 54; //退款状态
    int32 refund_type = 55; //退款类型
    int64 combination_id = 56; //拼团商品id
    int64 pink_id = 57; //拼团id
    int64 seckill_id = 58; //秒杀商品ID
    int64 bargain_id = 59; //砍价id
    int64 advance_id = 60; //预售商品ID
    int64 spread_uid = 61; //推广人ID
    int64 spread_two_uid = 62; //上级推广人ID
    string is_gift = 63; //是否礼品订单
    int64 gift_price = 64; //礼品附加费
    int64 gift_uid = 65; //接受礼品用户ID
    string gift_mark = 66; //礼物留言
    string status = 67; //订单状态
    int64 audit_time = 68; //审核时间
    int64 pay_uid = 69; //支付用户ID
    int64 pay_time = 70; //确认时间
    int64 delivery_time = 71; //确认时间
    int64 collect_time = 72; //收货时间
    int64 cancel_time = 73; //取消时间
    int64 close_time = 74; //退款完成时间
    int64 comment_time = 75; //订单完成时间
    int64 updated_at = 76; //创建时间
    int64 created_at = 77; //修改时间
    string deleted_at = 78; //删除时间
    string is_cancel =79; //是否已取消
    OrderAddress address =80;
    MemberInfo member = 81;
    PaymentInfo payment = 82;
    repeated OrderDetail details = 83;
    repeated DeliveryOrder packages =87;
    map<string,string> metas =85;
    OrderAdminCommand adminAction =88;
    OrderUserAction userAction =89;
    OrderShowStatus showStatus =91; //显示状态
    OrderProgress progress_info = 93;
    bool paid =95; //已支付
    bool is_apply_refund =97;//是否允许申请退款
    bool is_refund_available =98; //是否可售后服务
    OrderPayHelpInfo help_info =99;
    OrderGiftUserInfo gift_user_info =100;
    //--ext---
    string from_type_name =101; //终端类型名称
    string routine_type_name =102; //小程序名称
    string pay_type_name =103; //支付类型名称
    string status_name =104; //状态名称
    string status_color =105; //状态颜色
    string pay_status_name =106; //支付状态名称
    string refund_status_name =107; //退款状态名称
    string refund_type_name =108; //退款类型名称
    string shipping_type_name =109;//配送类型名称
}

//订单礼物人信息
message OrderGiftUserInfo{
    string gift_uid =1; //礼物人ID
    string gift_nickname =2; //礼物人昵称
    string gift_avatar =3;//礼物人头像
}

//订单代付信息
message OrderPayHelpInfo{
    string pay_uid =1; //代付人ID
    string pay_nickname =2; //代付人昵称
    string pay_avatar =3;//代付人头像
    string help_status =4;//代付状态
}

//订单详情步骤
message OrderProgress {
    step current =1;
    repeated step steps =2;
    message step {
        string code =1;
        string name =2;
        string short_name =3;
        string icon_url =4;
        string status =5;
        string happen_at =6;
        string description =7;
    }
}

//管理员命令
message OrderAdminCommand{
    bool hasOrderConfirm =1; //允许确认订单
    bool hasOrderDelivery =2; //允许订单发货
    bool hasOrderCancel =3;// 允许取消订单
    bool hasOrderDelete =4;// 允许删除订单
    bool hasOfflinePaid =5;// 允许线下支付确认
    bool hasModifyAddress =6;// 允许修改地址
    bool hasModifyPrice =7;// 允许订单改价
}

//用户命令
message OrderUserAction{
    bool hasOrderPay =1; //订单支付
    bool hasOrderCollect =2; //订单收货
    bool hasOrderCancel =3;// 取消订单
    bool hasOrderDelete =4;// 删除订单
    bool hasOrderComment =7;// 订单评论
    bool hasLogisticsQuery =5;// 发货物流查询
    bool hasRefundLogisticsQuery =6;// 退货物流查询
    bool hasWriteReturn =8;//填写退货信息
    bool hasBuyAgain =9; //再次购买
    bool hasRefundApply =10;//申请退款
    bool hasRefundCancel =11; //取消申请退款
    bool hasInvoiceApply =12;//开票申请
    bool hasInvoiceView =13;//发票查看
}

//显示状态
message OrderShowStatus{
    string class =1; //如:nobuy
    string deliveryType =2; //配送方式
    string msg =3; //提示信息
    string payType =4; //支付类型
    string title =5; //标题
    int64 type =6; //类型
    string status_pic =8; //状态图片
}


message OrderPayRequest {
    int64 order_id = 1;
    string order_no = 2;
    string str_ids = 3;
    string client_type =4;
    int32 payment_id =5;
    string pay_type =6; //支付类型
    bool proxy =7; //代他人支付
    string auth_code =8; //付款码
    int64 member_id =9;
    repeated int64 ids = 12;
}

//下线支付确认请求
message OfflinePaidRequest{
    string transaction_no = 1; //交易单号
    string channel =2; //收款渠道
    string recipient =3; //收款人
    string account =4; //收款账号
    int64 date = 5; //收款日期
    string remark = 6; //备注信息
    int64 order_id = 7; //订单ID
    string order_no = 8; //订单号
}


// 订单请求参数
message OrderRequest {
    int32 top = 1;
    int64 paged = 2;
    int64 page_size = 3;
    string keywords = 4;
    repeated string sorts = 5;
    repeated string date_range = 6;
    repeated int64 ids = 7;
    int64 id = 8;
    //以下为自定义参数
    string type = 11; //订单类型
    int64 member_id = 12; //买家ID
    int64 shop_id = 13; //多商户ID
    int64 realstore_id = 14; //多门店ID
    int64 clerk_id = 15; //店员ID
    string is_modify_price = 16; //已修改价格
    string is_multi_package = 17; //多包裹发货
    string is_delivered = 18; //已全部发货
    string table_code = 19; //桌台编号
    string is_cod = 20; //是否货到付款
    string is_invoiced = 21; //已开过发票
    string is_refunded = 22; //已产生退款
    string is_modify_address = 23; //已修改地址
    string routine_type = 24; //小程序类型
    string pay_type = 25; //支付类型
    string from_type = 26; //客户端类型
    string out_system_id = 27; //外部系统ID
    string pay_status = 28; //支付状态
    int64 combination_id = 29; //拼团商品id
    int64 pink_id = 30; //拼团id
    int64 seckill_id = 31; //秒杀商品ID
    int64 bargain_id = 32; //砍价id
    int64 advance_id = 33; //预售商品ID
    int64 spread_uid = 34; //推广人ID
    string is_gift = 35; //是否礼品订单
    string status = 36; //订单状态:0待支付, 1待发货, 2待收货, 3待评价, 4已完成, 5已关闭
    int32 shipping_type = 37; //配送类型

    //其它参数
    string order_no = 40; //订单号
    string ship_status =41; //发货状态：1-待发货，2-已发货，3-已完成
    int32 status_type =42;//状态类型：0-全部,1-待付款，2-待发货，3-待收货，4-待评价，
    string search_type =43;//搜索类型：shipment 订单发货
}


message OrderPayData {
    string status =1; //支付状态：success 成功,fail 失败, unknown 未知（需要查询确认）
    int32 err_code =2; //错误代码
    string err_desc =3; //错误代码描述
    OrderPayResultInfo result =4;
}

message OrderPayResultInfo{
    int64 order_id =1;
    string order_no =2;
    string pay_url =3;
    bytes jsConfig =4;
}

message OrderSearchData {
    common.Pager pager =1;
    repeated Order items =2;
}

message OrderResponse {
    string msg =1;
    Order order = 2;
    repeated Order list =3;
    OrderSearchData search =4;
    OrderPayData pay =5;
}