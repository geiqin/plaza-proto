syntax = "proto3";
package services;
option go_package = "/.;services";
import "common/base.proto";
import "orderDetailService.proto";
import "orderAddressService.proto";
import "baseInfoService.proto";
import "paymentService.proto";

//订单
service OrderService {

    //修改价格
    rpc ModifyPrice (Order) returns (OrderResponse) {}
    //修改地址
    rpc ModifyAddress (OrderAddress) returns (OrderResponse) {}
    //订单追加备注
    rpc AppendRemark (OrderRequest) returns (OrderResponse) {}

    //确认接受订单(接单/拒单操作)
    rpc ConfirmAccept(OrderRequest) returns (OrderResponse) {}
    //确认撤销订单
    rpc ConfirmCancel (Order) returns (OrderResponse) {}
    //确认删除订单
    rpc ConfirmDelete (Order) returns (OrderResponse) {}
    //确认已签收（客户操作）
    rpc ConfirmSigned(OrderRequest) returns (OrderResponse) {}
    //确认已结算操作
    //结算订单(无法通过正常流程完成订单,需要商家主动完成订单)
    //适用订单: 堂食餐后付款订单、货到付款订单、外卖餐到付款订单
    rpc ConfirmSettled (OrderRequest) returns (OrderResponse) {}
    //确认核销订单（如扫码核销）
    rpc ConfirmVerified (OrderRequest) returns (OrderResponse) {}

    //获取订单信息
    rpc Get (Order) returns (OrderResponse) {}
    //显示订单信息(详细信息)
    rpc Display (Order) returns (OrderResponse) {}
    //前端显示订单信息(详细信息)
    rpc FrontDisplay (Order) returns (OrderResponse) {}
    //查询订单
    rpc Search (OrderRequest) returns (OrderResponse) {}
    //按条件获取订单列表
    rpc List (OrderRequest) returns (OrderResponse) {}
    //获取订单赠送\使用的优惠券列表
    rpc GetCouponList (OrderRequest) returns (OrderResponse) {}
    //订单支付
    rpc Pay (OrderRequest) returns (OrderPayResponse) {}
    //订单相关统计
    rpc Count (OrderRequest) returns (OrderCountResponse) {}
}

message Order {
    int64  id =1; //ID
    string order_sn =2; //单号
    string order_type =3; //订单类型: general普通订单, card权益卡订单,recharge充值订单,retail分销订单(已弃用),hotel酒店商品订单,group多人拼团订单,eat_room 堂食订单,eat_out 外卖订单
    int64  shop_id =4; //分店ID
    int64  member_id =5; //买家ID
    int32  buy_number_count =6; //购买商品总数量
    int64  increase_price =7; //增加的金额
    int64  preferential_price =8; //优惠金额
    int64  actual_price =9; //订单总价(订单最终价格)
    int64  total_price =10; //订单单价
    int64  paid_money =11; //已支付金额
    int64  refunded_money =12; //已退款金额
    int32  returned_quantity =13; //已退货数量
    string client_type =14; //客户端类型（pc, h5, ios, android, alipay, weixin, baidu）取APPLICATION_CLIENT_TYPE常量值
    string order_model =15; //订单模式
    string subject =23; //订单标题。
    string body =24; //订单商品描述信息。
    int64  cover_id =25; //订单商品封面ID
    string cover_url =26; //订单商品封面URL（默认取商品明细里数量最多的商品主图）
    string postscript =27; //订单附言,由用户提交订单前填写
    string seller_note =28; //商家留言,当该字段值时可以在订单查询看到
    string pay_note =29; //付款备注, 在订单管理编辑修改
    string channel_type =31; //支付通道类型
    bool   is_dispatched =32; //是否已分发
    bool   is_safeguard_closed =33; //是否售后已关闭
    bool   is_under_line =34; //是否线下支付（0否，1是）
    bool   is_cod =35; //是否货到付款
    bool   is_invoiced =36; //是否已过开票
    bool   is_modified =37; //是否订单已改过价 【订单改价】
    bool   is_paid =39; //是否已付款。当订单的全部金额已结清
    bool   is_safeguard =40; //是否参与过维权，无论维权是否成功。
    bool   is_separate =41; //是否已分成0未分成或等待分成;1已分成;2取消分成
    bool   is_shipment =42; //是否需要物流派送
    bool   is_refunded =43; //是否已产生退款
    bool   is_pay_timeout =44; //是否支付已超时
    bool   is_return_timeout =45; //是否退货已超时
    bool   is_finished =46; //是否已完成（最终完成，指不可维权）
    string dispatch_type =47; //配送方式:express快递发货，delivery同城配送，fetch 到店自提
    int32  payment_id =48; //用户选择的支付方式的id,取值表payment
    int64  warehouse_id =49; //仓库ID
    int64  parent_id =50; //父级订单: 有值表示子订单
    string cancel_type =51; //取消类型:【枚举：OrderCancelType】
    string ship_status =52; //发货状态:【枚举：OrderShipStatus】
    string pay_status =53; //付款状态:【枚举：OrderPayStatus】
    string status =54; //订单状态:【枚举：OrderStatus】
    string pay_expire_date =55; //支付截止时间，配合IsPayTimeout字段，时间范围在订单创建后的 5 分钟到 7 天，默认值为 1 天，
    string return_expire_date =56; //退货截止时间，配合IsReturnTimeout字段
    string confirm_at =57; //订单确认时间
    string paid_at =58; //订单支付时间
    string shipped_at =59; //订单发货时间
    string signed_at =60; //签收完成时间
    string refunded_at =61; //退款完成时间
    string finished_at =62; //订单完成时间
    string status_name =63; //状态名称
    string status_color =64; //状态颜色
    OrderCurrency  currency=68;
    OrderAddress address =69;
    MemberInfo member = 70;
    Payment payment = 71;
    repeated OrderDetail details = 72;
    repeated OrderExtension extension_data = 73;
    map<string,string> metas =74;
    WarehouseInfo warehouse_data =75;
    OperateInfo operate_data =76;
    bool is_can_launch_aftersale =77; //是否启动售后服务
}

message OrderCurrency{
    int64 id =1;
    int64 order_id =2;
    int64 user_id =3;
    string currency_name =4;
    string currency_code =5;
    string currency_symbol =6;
    float currency_rate =7;
    string created_at =8;
    string updated_at =9;
}


message OperateInfo{
    bool is_cancel =1;//取消
    bool is_pay =2;//支付
    bool is_collect =3;//收货
    bool is_delete =4;//删除
    bool is_comments =5;//评论
    bool is_express =6;//物流
}

message OrderExtension {
    int64 id = 1;
    string name = 2;
    string type = 3;
    int64 price = 4;
    string business = 5;
    string tips = 6;
}

message OrderRequest {
    int32 paged =1;
    int32 page_size =2;
    string	keywords =3;
    //----------
    int64 id = 4;
    string order_sn = 5;
    string type = 6;
    int64 shop_id =7;
    int64 member_id  =8;
    int32 pay_type = 9;
    bool is_shipment = 10;
    bool is_cod = 13;
    bool is_invoiced = 14;
    bool is_modified = 15;
    bool is_paid = 16;
    bool is_safeguard = 17;
    bool is_separate = 18;
    int32 shipping_id = 19;
    string shipping_name =20;
    int32 payment_id =21;
    string channel_type =22;
    int32 pack_id =23;
    int64 coupon_id =24;
    string extension_code =25;
    int64 extension_id =26;
    string ship_status =27;
    string status =28;
    string pay_status =29;
    string cancel_type =30;
    string start_date = 31;
    string end_date = 32;
    string str_ids = 33;
    repeated int64 ids = 34;
}

//订单统计数据
message OrderCountData{
    int64 member_id =1;//会员ID
    int64 order_count =2; //订单总数
    int64 order_pending_count =3; //待审核数量
    int64 order_confirmed_count =4; //待支付数量
    int64 order_paid_count =5; //待发货数量
    int64 order_shipped_count =6; //待发货数量
    int64 order_canceled_count =7; //已取消数量
    int64 order_succeed_count =8; //已完成数量
    int64 order_closed_count =9; //已关闭数量
    int64 aftersale_doing_count =10; //正在售后服务数量
}

message OrderData {
    Order entity = 1;
    common.Pager pager =2;
    repeated Order items = 3;
    common.Info info =4;
    OrderFlow order_flow = 5;
    repeated PaymentInfo payment_list =6;
}

message OrderPayData {
    int64 order_id =1;
    string order_sn =2;
    string payment_type =3;
    bool is_success =4;
    map<string,string> params = 5;
    PaymentInfo payment  =6;
    bool is_html =7;
    string html_text =8;
}

message OrderResponse {
    OrderData data = 1;
    common.Error error = 2;
}

message OrderPayResponse {
    OrderPayData data = 1;
    common.Error error = 2;
}

message OrderCountResponse {
    OrderCountData data = 1;
    common.Error error = 2;
}