syntax = "proto3";
package services;
option go_package = "/.;services";
import "common/base.proto";
import "orderAddressService.proto";
import "baseInfoService.proto";
//结账台
service BuyService {
    //确认信息
    rpc Confirm (BuyRequest) returns (BuyResponse) {}
    //提交订单
    rpc Submit (BuyRequest) returns (BuyResponse) {}
}

//购买分组
message BuyGroup {
    int64 id = 1;
    string name = 2;
    string alias = 3;
    string icon_url = 4;
    string lng = 5;
    string lat = 6;
    int64 area_id = 7;
    string address = 8;
    string province_name = 9;
    string city_name = 10;
    string county_name = 11;
    OrderBase order_base =12;//订单基本信息
    repeated BuyGoodsItem goods_items = 13; //商品列表
}

message BuyGoodsItem  {
    int64  id =1;//ID
    string title =2;//标题
    string image_url =3;//封面图片
    int64  spu_id =4;//商品spuId
    string md5_key =5;//商品规格md5_key
    int32  inventory =6;//库存数量
    int64  original_price =7;//原价
    int64  price =8;//销售价格
    int32  buy_min_number =9; //购买数量
    int32  buy_max_number =10;//购买数量
    int64  spec_weight =11;//规格重量
    int64  spec_volume =12; //规格体积
    string spec_coding =13; //规格编码
    string spec_barcode =14;//规格条码
    string unit =15;//库存单位
    map<string,string> extends =16;//扩展数据
    string is_invalid =17;//是否无效（0否，1是）
    string is_error =18;//是否错误（0否，1是）
    string error_msg =19;//错误信息
    int32 stock =20;//购买数量
    int64 subtotal_price =21;//商品小计
    repeated SpecificationData spec =22; //规格描述
    string spec_text =23;
    string brand_name =24;
    string goods_url =25;
    string site_type =26;
}


//订单基础信息
message OrderBase {
    int64  total_price =1; //订单总价
    int64  actual_price =2; //订单实际支付金额(已减去优惠金额, 已加上增加金额)
    int64  increase_price =3; //增加金额
    int64  preferential_price =4; //优惠金额
    int32  goods_count =5; //商品总数
    int64 spec_weight_total =6;//规格重量总计
    int64 spec_volume_total =7; //规格体积总计
    int32  buy_count =8; //购买总数
    string site_model =9; //当前使用的站点模式
    string common_site_type =10; //公共站点模式
    OrderAddress address =11;//收件地址
    repeated OrderAddress extraction_address =12; //自提点地址
    // 仓库组扩展展示数据
    // name 名称
    // price 金额
    // type 类型（0减少, 1增加）
    // tips 提示信息
    // business 业务类型（内容格式不限）
    // ext 扩展数据（内容格式不限）
    // $extension_data = [
    // [
    //     'name'       => '感恩节9折',
    //     'price'      => 23,
    //     'type'       => 0,
    //     'tips'       => '-￥23元',
    //     'business'   => null,
    //     'ext'        => null,
    // ],
    // ];
    repeated ExtensionData extension_data = 13; //扩展数据
}

//扩展展示数据
message ExtensionData {
    string name =1;//名称
    int64  price =2;//价格
    string type =3;//类型
    string business =4;//业务名称
    string tips =5;//提示信息
}

//确认信息请求参数
message BuyRequest {
    string buy_type = 1; //购买类型
    int64 address_id = 2; //收货地址ID
    string postscript = 3; //买家留言(50字以内)
    int32 shipment_id = 4; //选中的配送方式
    int32 payment_id = 5; //选中的支付方式
    int64 coupon_id = 6; //选中的优惠劵凭证ID
    int64 use_integral = 7; //使用的积分数
    int64 use_surplus = 8; //使用的余额数
    int64 buy_member_id = 9; //代理的客户ID（操作员代客下单）
    int64 spu_id =10; //直接购买SpuId
    int64 sku_id =11; //直接购买SkuId
    int32 stock =12; //直接购买数量
    repeated SpecificationData spec =13; //规格信息
    repeated int64 ids = 14; ///购物车ids
    BuyGoodsData goods_data =17;
}

message BuyGoodsData {
    int64 spu_id = 1; //商品ID
    int32 stock = 2; //数量
    repeated SpecificationData spec =3; //规格
    string md5_key =4;//商品规格md5_key
}


message BuyData {
    BuyConfirmData confirm = 1;//购买确认信息
    BuySubmitData submit = 2;//购买提交信息
    string is_order_submit = 3; //是否订单已提交 0否，1是
}

//购买确认数据
message BuyConfirmData {
    OrderBase base = 1;//结算信息(汇总)
    repeated BuyGroup group_list =2; //分组商品列表
    repeated PaymentInfo payment_list =3; //支付方式列表
    BuyRequest request_data =4;//提交信息反馈
    int32 default_payment_id =7;//默认支付ID
    string common_site_type =8;//站点类型
    map<string,string> extension_data =9; //扩展数据
    map<string,string> plugins_data =10;//插件数据
}

//购买提交数据
message BuySubmitData {
    string order_status =1;
    repeated int64 order_ids =2;
    int32 payment_id =3;
    string jump_url =4;
}

message BuyResponse {
    BuyData data = 1;
    common.Error error = 2;
}
