syntax = "proto3";
package services;
option go_package = "/.;services";
import "common/base.proto";
import "baseInfoService.proto";
import "skuInfoService.proto";

//价格计算器
service CalculatorService {
  //购物车计算
  rpc Cart (PurchaseRequest) returns (CalculatorResponse) {}
  //下单购买计算
  rpc Purchase (PurchaseRequest) returns (CalculatorResponse) {}
  //商品显示计算
  rpc Display (DisplayRequest) returns (CalculatorResponse) {}
}

//购买计算结果
message PurchaseResult {
  string currency =1; //货币类型
  int32 total_num =2; //总数量
  int64 total_weight =3; //总重量
  int64 total_price =4; //销售总格
  int64 total_discount =5;//优惠总额
  int64 total_amount =6;//应付金额
  int64 pay_money =7;//支付现金
  int64 freight_fee =8; //运费
  int64 insure_fee =9; //保险费
  int64 pack_fee =10; //包装费
  int64 surplus =11;//使用账户余额
  int64 coupon_id = 12;//使用优惠劵ID
  int64 coupon_money =13; //使用优惠劵金额
  int64 integral =14; //积分数量
  int64 integral_money =15;//积分金额
  int64 paid_money =16;//已支付现金
  int64 member_id =17;//会员ID
  bool is_shipment =18;//是否物流
  repeated PurchaseSkuInfo skus = 19; //购买商品列表
  repeated CouponInfo coupons = 20; //可获得的优惠
  repeated PromotionInfo promotions = 21; //参与的活动
  repeated AdjustmentInfo adjustments =22;//变动记录
  repeated SkuInfo presents =23; //可获得的赠品
  //available
  int64 available_surplus =24;//可使用的余额
  int64 available_integral =25;//可使用的积分
  CouponInfo available_coupons = 26;//可使用的优惠劵集合
}

//购买商品信息
message PurchaseSkuInfo {
  int64	sku_id =1;
  int32 num =2;
  int64 price = 3;
  int64 promotion_price = 4;
  int64 member_price = 5;
  int64 subtotal_price = 6;
  int64 subtotal_discount = 7;
  int64 subtotal_amount = 8;
  SkuInfo sku =9;
  repeated PromotionInfo promotions = 10;
}

//显示商品信息
message DisplaySkuInfo{
  int64	sku_id	=1;
  int64 price = 2;
  int64 member_price = 3;
  int64 promotion_price = 4;
  int64 subtotal_amount = 5;
  int64 subtotal_discount = 6;
  repeated PromotionInfo promotions =7;
}

//参与的活动
message PromotionInfo {
  int64 id = 1; //活动ID
  string code = 2; //活动编码:如：coupon_20210101212
  string title = 3; //活动标题
  string type = 4; //活动类型:Coupon优惠劵/满减送/限时折扣/秒杀/拼团/通用
  string subtype = 5; //活动子类型
  string tag = 6; //标签
}

message AdjustmentInfo {
  int64 sku_id = 1;
  string type = 2;
  string label = 3;
  string origin_code = 4;
  int64 amount =5;
  bool included =6;
}

message PurchaseRequest {
  int64 address_id = 1;
  int64 coupon_id = 2;
  int64 shop_id = 3;
  int64 order_id = 4;
  string terminal =5;
  string channel =6;
  string payment_method = 7;
  string shipment_method = 8;
  int64 insure_fee =9;
  int64 pack_fee =10;
  int64 surplus =11;
  int64 coupon_money =12;
  int64 integral =13;
  int64 integral_money =14;
  int64 paid_money =15;
  string currency =16;
  int64 area_id = 17;
  BuyerInfo buyer =18; //买家信息
  repeated sku  skus =19;//需要计算的SKUS
  //需要计算的商品
  message sku {
    int64 sku_id =1;
    int32 num =2;
    int64 price =3;
    int64 weight =4;
    int64 volume =5;
    int32 stock = 6;
    bool is_virtual = 7;
    bool is_member_right = 8;
    bool is_member_price = 9;
    string freight_type =10;
    int64 freight_uniform_fee =11;
    int64 freight_express_id =12;
  }
}


message DisplayRequest {
  string currency =1; //货币类型
  int64 area_id = 2;//所在区域ID
  BuyerInfo buyer =3; //买家信息
  repeated sku skus =4; //需要计算的skus
  //需要计算的商品
  message sku {
    int64 sku_id =1; //skuId
    int64 weight =2; //重量
    int64 price =3; //销售价
    int64 member_price =4; //会员价
    bool is_member_price =5;//是否自定义会员价
  }
}


message CalculatorData{
  PurchaseResult cart_result =1;
  PurchaseResult purchase_result =2;
  repeated DisplaySkuInfo display_result =3;
}

message CalculatorResponse {
  CalculatorData data = 1;
  common.Error error = 2;
}
